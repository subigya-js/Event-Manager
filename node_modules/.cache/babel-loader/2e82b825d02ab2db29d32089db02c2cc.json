{"ast":null,"code":"/*!\r\n * unpipe\r\n * Copyright(c) 2015 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\n\n'use strict';\n\n/**\r\n * Module exports.\r\n * @public\r\n */\nmodule.exports = unpipe;\n\n/**\r\n * Determine if there are Node.js pipe-like data listeners.\r\n * @private\r\n */\n\nfunction hasPipeDataListeners(stream) {\n  var listeners = stream.listeners('data');\n  for (var i = 0; i < listeners.length; i++) {\n    if (listeners[i].name === 'ondata') {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\r\n * Unpipe a stream from all destinations.\r\n *\r\n * @param {object} stream\r\n * @public\r\n */\n\nfunction unpipe(stream) {\n  if (!stream) {\n    throw new TypeError('argument stream is required');\n  }\n  if (typeof stream.unpipe === 'function') {\n    // new-style\n    stream.unpipe();\n    return;\n  }\n\n  // Node.js 0.8 hack\n  if (!hasPipeDataListeners(stream)) {\n    return;\n  }\n  var listener;\n  var listeners = stream.listeners('close');\n  for (var i = 0; i < listeners.length; i++) {\n    listener = listeners[i];\n    if (listener.name !== 'cleanup' && listener.name !== 'onclose') {\n      continue;\n    }\n\n    // invoke the listener\n    listener.call(stream);\n  }\n}","map":null,"metadata":{},"sourceType":"script"}